{% extends "dashboard/base.html" %}
{% load static %}
{% load dashboard_filters %}
{% block title %}–£—á–∏—Ç–µ–ª—è{% endblock %}

{% block content %}
<div style="display: flex; gap: 40px;">
    <!-- –°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π -->
    <div style="width: 55%;">
        <h2>üë©‚Äçüè´ –°–ø–∏—Å–æ–∫ —É—á–∏—Ç–µ–ª–µ–π</h2>
        <table border="1" cellpadding="8" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>–§–ò–û</th>
                    <th>–ü—Ä–µ–¥–º–µ—Ç—ã</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for teacher in teachers %}
                <tr>
                    <td>{{ teacher.last_name }} {{ teacher.first_name }} {{ teacher.middle_name }}</td>
                    <td>
                        {% for subj in teacher.subjects.all %}
                            {{ subj.name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        <a href="?edit={{ teacher.id }}">‚úèÔ∏è</a>
                        <a href="?delete={{ teacher.id }}" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —É—á–∏—Ç–µ–ª—è?')">üóëÔ∏è</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="3">–ù–µ—Ç —É—á–∏—Ç–µ–ª–µ–π</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–ø—Ä–∞–≤–∞ -->
    <div style="width: 45%;">
        <h2>{{ edit_mode|yesno:"‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —É—á–∏—Ç–µ–ª—è,‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–∏—Ç–µ–ª—è" }}</h2>
        <form method="post">
            {% csrf_token %}
            {% if edit_id %}
            <input type="hidden" name="teacher_id" value="{{ edit_id }}">
            {% endif %}

            {{ form.non_field_errors }}

            
            <label>–§–∞–º–∏–ª–∏—è</label> {{ form.last_name }}
            <label>–ò–º—è</label> {{ form.first_name }}
            <label>–û—Ç—á–µ—Å—Ç–≤–æ</label> {{ form.middle_name }}
            <br><br>
            <label>–õ–æ–≥–∏–Ω</label> {{ form.username }}
            <label>–ü–∞—Ä–æ–ª—å</label> {{ form.password }}
            

            <h4>–ü—Ä–µ–¥–º–µ—Ç—ã:</h4>
            {% for area, subjects in form.subjects_by_area.items %}
                <details open style="margin-bottom: 10px;">
                    <summary><strong>{{ area }}</strong></summary>
                    {% for subject in subjects %}
                        <label style="display: block; margin-left: 15px;">
                            <input type="checkbox" name="subjects" value="{{ subject.id }}"
                                   {% if subject.id|stringformat:"s" in selected_subjects %}checked{% endif %}>
                            {{ subject.name }}
                        </label>
                    {% endfor %}
                </details>
            {% endfor %}

            <h4>–†–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è:</h4>

            <label style="display: inline-block; margin-bottom: 10px;">
                <input type="checkbox" id="select_all_time"> –†–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ –¥–Ω–∏ –∏ –≤—Å–µ —É—Ä–æ–∫–∏
            </label>

            <table border="1" cellpadding="5">
                <thead>
                    <tr>
                        <th>–£—Ä–æ–∫ / –î–µ–Ω—å</th>
                        {% for day in weekdays %}
                        <th>{{ day }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for lesson in lessons %}
                    <tr>
                        <td>{{ lesson }}</td>
                        {% for day in weekdays %}
                        <td>
                            <input type="checkbox"
                                class="worktime-checkbox"
                                name="wt_{{ day }}_{{ lesson }}"
                                {% if teacher and teacher.work_time|get_item:day and lesson in teacher.work_time|get_item:day %}checked{% endif %}>
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <br><button type="submit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggle = document.getElementById("select_all_time");
            const checkboxes = document.querySelectorAll(".worktime-checkbox");

            toggle.addEventListener("change", function () {
                checkboxes.forEach(cb => cb.checked = toggle.checked);
            });
        });
    </script>
</div>
{% endblock %}
